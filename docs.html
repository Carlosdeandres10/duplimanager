<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <meta name="audience" content="Sysadmins and Operations">
    
    <title>DupliManager - Documentaci√≥n de Operaciones de Sistema</title>
    <style>
        :root {
            --bg-color: #0f172a;
            --text-color: #e2e8f0;
            --accent: #3b82f6;
            --secondary-bg: #1e293b;
            --border: #334155;
            --warn: #f59e0b;
            --success: #22c55e;
            --sidebar-width: 300px;
        }
        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            margin: 0;
            padding: 0;
            font-size: 16px;
            display: flex;
        }
        
        /* Sidebar Styling */
        nav.sidebar {
            width: var(--sidebar-width);
            background-color: var(--secondary-bg);
            border-right: 1px solid var(--border);
            height: 100vh;
            position: fixed;
            overflow-y: auto;
            padding: 1.5rem 1rem;
            box-sizing: border-box;
        }
        nav.sidebar h2 { margin-top: 0; font-size: 1.2rem; margin-bottom: 1rem; }
        nav.sidebar ul { list-style: none; padding: 0; margin: 0; }
        nav.sidebar li { margin-bottom: 0.2rem; }
        nav.sidebar a {
            color: var(--text-color);
            text-decoration: none;
            display: block;
            padding: 0.4rem 0.8rem;
            border-radius: 6px;
            font-size: 0.95rem;
            transition: background 0.2s;
        }
        nav.sidebar a:hover { background-color: rgba(59, 130, 246, 0.2); color: var(--accent); }
        .nav-category {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #94a3b8;
            margin: 1.5rem 0 0.5rem 0.5rem;
            font-weight: 600;
        }
        
        /* Main Content Styling */
        main {
            flex-grow: 1;
            margin-left: var(--sidebar-width);
            padding: 2rem 4rem;
            max-width: 1000px;
        }
        header { border-bottom: 1px solid var(--border); margin-bottom: 2rem; padding-bottom: 1rem; }
        h1, h2, h3 { color: #fff; }
        h1 { font-size: 2.5rem; margin-bottom: 0.5rem; }
        h2 { border-bottom: 2px solid var(--border); padding-bottom: 0.5rem; margin-top: 3rem; color: var(--accent); scroll-margin-top: 2rem; }
        .sysadmin-alert {
            background-color: rgba(59, 130, 246, 0.1);
            border-left: 4px solid var(--accent);
            padding: 1rem;
            margin: 1.5rem 0;
            border-radius: 0 8px 8px 0;
        }
        .warn-alert {
            background-color: rgba(245, 158, 11, 0.1);
            border-left: 4px solid var(--warn);
            padding: 1rem;
            margin: 1.5rem 0;
            border-radius: 0 8px 8px 0;
        }
        code { background-color: #000; padding: 0.2rem 0.4rem; border-radius: 4px; font-family: 'Fira Code', monospace; font-size: 0.9em; }
        .file-card {
            background-color: var(--secondary-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            scroll-margin-top: 2rem;
        }
        .file-card h3 { margin-top: 0; display: flex; align-items: center; gap: 0.5rem; font-family: monospace; font-size: 1.2rem; }
        .badge { font-size: 0.75rem; background: var(--accent); padding: 0.2rem 0.6rem; border-radius: 999px; font-weight: bold; font-family: sans-serif; }
        .badge-warning { background: var(--warn); color: black; }
        
        ul { padding-left: 1.5rem; }
        li { margin-bottom: 0.5rem; }
    </style>
</head>
<body>

    <nav class="sidebar">
        <h2>üìö √çndice de Operaciones</h2>
        <ul>
            <li><a href="#intro">Visi√≥n General</a></li>
            
            <div class="nav-category">Almacenamientos F√≠sicos</div>
            <li><a href="#f-config">config/ (Bases de datos)</a></li>
            <li><a href="#f-logs">logs/ (Registros de salud)</a></li>
            <li><a href="#f-bin">bin/ (Ejecutables Core)</a></li>

            <div class="nav-category">Arranque del Servicio</div>
            <li><a href="#backend">Servidor de Procesos</a></li>
            <li><a href="#venv">Entornos Virtuales de Python</a></li>

            <div class="nav-category">Gu√≠as de Soluci√≥n de Errores</div>
            <li><a href="#troubleshooting">C√≥digos de error y Reinicios</a></li>
        </ul>
    </nav>

    <main>
        
        <header id="intro">
            <h1>Manual de Operaciones DupliManager</h1>
            <p>Gu√≠a T√©cnica de Administraci√≥n de Sistemas y Redes para el despliegue de copias de seguridad.</p>
        </header>

        <div class="sysadmin-alert">
            <strong>üöÄ Visi√≥n 10,000 Pies:</strong> DupliManager no es un software monol√≠tico bloqueado. Es una interfaz ligera (Frontend) y un orquestador (Backend) dise√±ados espec√≠ficamente para interactuar por debajo con la herramienta de la l√≠nea de comandos de terminal, `duplicacy`. Lo que vayas pinchando en el panel, el sistema lo traduce a comandos de consola detr√°s de las cortinas.
        </div>

        <h2>üìñ Glosario de Conceptos Reales</h2>
        <ul>
            <li><code>Storage</code> / <code>Destino</code>: El lugar final al que van los archivos cifrados, como un Bucket de Wasabi, Amazon S3, un disco duro USB o un servidor SFTP de emergencia.</li>
            <li><code>Repo</code> / <code>Tarea de Copia</code>: Define qu√© carpeta local quieres llevar hacia qu√© Destino, junto con la contrase√±a para encriptarlo. Al panel en esta herramienta lo llama "Backup".</li>
            <li><code>Snapshot</code> / <code>Revisi√≥n</code>: Piensa en esto como una rama de Git de tus archivos pero para tus backups. Un "hilo" constante hist√≥rico de subidas incrementales de la tarea de copia.</li>
        </ul>

        <h2 id="f-structure">üß© Arquitectura del Producto (Caracter√≠sticas Funcionales)</h2>

        <div class="file-card">
            <h3>server_py/routers/ <span class="badge">L√≥gica de Negocio (Backend)</span></h3>
            <p><strong>Visi√≥n del Producto:</strong> Este componente gestiona las reglas de negocio cuando el usuario interact√∫a con la interfaz. Determina qu√© est√° permitido hacer y procesa las instrucciones cr√≠ticas de datos.</p>
            <ul>
                <li><strong><code>backups.py</code> (Gestor de Tareas):</strong> Gestiona el Ciclo de Vida de las copias. Permite al usuario iniciar nuevas tareas de respaldo manuales o cancelar las que est√°n en curso, y actualiza la barra de progreso de la UI.</li>
                <li><strong><code>storages.py</code> (Gestor de Nube):</strong> Administra la "B√≥veda" de destinos. Conecta y valida autom√°ticamente las credenciales de Amazon S3 o Wasabi que el usuario introduce en el panel, asegurando que la conexi√≥n sea v√°lida antes de continuar.</li>
                <li><strong><code>restore.py</code> (Motor de Recuperaci√≥n):</strong> Facilita una caracter√≠stica fundamental: el √°rbol visual de recuperaci√≥n. Habla con la nube para listar qu√© archivos existen, permitiendo al usuario navegar y seleccionar qu√© desea restaurar sin comandos complejos.</li>
                <li><strong><code>system.py</code> (Utilidades Web):</strong> Mantiene informada a la interfaz sobre la "Salud" de la aplicaci√≥n, como encender el bot√≥n verde que indica que el motor funciona correctamente.</li>
            </ul>
        </div>

        <div class="file-card">
            <h3>server_py/core/ <span class="badge">Automatizaci√≥n Transparente</span></h3>
            <p><strong>Visi√≥n del Producto:</strong> Estos m√≥dulos aportan el valor diferencial del "Set it and forget it" (Config√∫ralo y olv√≠dalo). Operan en segundo plano de manera aut√≥noma.</p>
            <ul>
                <li><strong><code>helpers.py</code> (El Planificador Silencioso):</strong> Act√∫a como el vigilante del sistema. Revisa constantemente las frecuencias (ej: "Lunes a las 02:00") que el usuario configur√≥ en la interfaz web y ejecuta las copias de seguridad de forma totalmente autom√°tica a su hora.</li>
                <li><strong><code>remote_cache.py</code> (Acelerador de Interfaz):</strong> Mantiene una memoria r√°pida temporal de la nube. Su objetivo de producto es que el usuario no sufra tiempos de carga excesivos viendo spinners de carga cuando navega por su historial de backups en el panel web.</li>
            </ul>
        </div>

        <div class="file-card">
            <h3>web/js/modules/ <span class="badge">La Experiencia de Usuario (SPA)</span></h3>
            <p><strong>Visi√≥n del Producto:</strong> Es la interfaz premium que ve el usuario. Est√° construida como una Single-Page Application (SPA) para que la transici√≥n entre men√∫s sea instant√°nea y moderna, pareci√©ndose a una app nativa en lugar de una p√°gina web tradicional.</p>
            <ul>
                <li><strong><code>views/</code> (Pantallas):</strong> Contiene el dise√±o y la interactividad de cada m√≥dulo del panel izquierdo. Por ejemplo, el <code>dashboard.js</code> genera las m√©tricas visuales clave (Tarjetas Resumen) para que el estado de salud de los datos se entienda de un solo vistazo.</li>
                <li><strong><code>components/</code> (Pop-ups Din√°micos):</strong> Dise√±ados para que el usuario no pierda el contexto de lo que estaba haciendo. Cuando pinchan "Nuevo Repositorio", aqu√≠ se definen las ventanas flotantes que les gu√≠an paso a paso como un asistente visual (Wizard).</li>
            </ul>
        </div>

        <h2 id="f-config">üìÇ Persistencia de Datos y Configuraci√≥n (Estado del Usuario)</h2>

        <div class="file-card">
            <h3>config/ <span class="badge">Archivos de Estado JSON</span></h3>
            <p><strong>Visi√≥n del Producto:</strong> Para facilitar la portabilidad, el producto no exige instalar bases de datos gigantescas. El perfil, las cuentas en la nube de este usuario y los registros de sus tareas se guardan en archivos JSON ligeros, garantizando que el usuario entienda qu√© datos guarda la app de √©l.</p>
        </div>

        <h2 id="f-logs">üìÑ Auditor√≠a y Registro Completo (Logs)</h2>

        <div class="file-card">
            <h3>logs/ <span class="badge">Hist√≥rico Diarios de Eventos</span></h3>
            <p><strong>Visi√≥n del Producto:</strong> La confianza es clave en el negocio del Backup. Cada acci√≥n, desde una copia exitosa hasta un fallo de contrase√±a de Amazon, se anota en el <code>duplimanager.log</code> para ofrecer transparencia y trazabilidad t√©cnica en caso de soporte a cliente.</p>
        </div>

        <h2 id="backend">üõ†Ô∏è Operaciones del Servicio del Servidor</h2>

        <div class="file-card">
            <h3>python -m server_py.main <span class="badge badge-warning">Proceso Activo</span></h3>
            <p><strong>Arranque del Motor de Fast API:</strong> DupliManager arranca el puerto local TCP invocando el Uvicorn (un emisor de red). √âste aloja permanentemente la web SPA en localhost:8500 por defecto.</p>
            <p><strong>El problema de los "Servidores Fantasma" Win32:</strong> En Windows a diferencia de Linux, puede ocurrir que al cerrar bruscamente una consola o fallar al reiniciar el servicio el puerto `8500` siga "enganchado" a un subproceso python en segundo plano (zombie). DupliManager reportar√° que es incapaz de arrancar por puerto ocupado.</p>
            <p>Acu√©rdate del comando sagrado frente a cierres en falso:</p>
            <code>Get-Process -Name python -ErrorAction SilentlyContinue | Stop-Process -Force</code>
        </div>
        
        <h2 id="venv">üêç Entornos Virtuales de Python</h2>

        <div class="file-card">
            <h3>.venv/ <span class="badge">Aislamiento de M√≥dulos</span></h3>
            <p><strong>Dato cr√≠tico:</strong> Nunca inicies "pip install X" a lo loco para instalar las dependencias si lo haces globalmente desde la computadora principal.</p> 
            <p>Mantenemos estrictamente encapsulado el servidor web a este directorio para no ensuciar otras aplicaciones del OS. El archivo `requirements.txt` define las cuatro librer√≠as puntuales del motor. Act√≠valo en consola (`.venv\Scripts\Activate.ps1`) antes de levantar el servidor por comandos, caso contrario se quejar√° de la falta de un modulo FastAPI.</p>
        </div>


        <h2 id="f-structure">üèóÔ∏è Arquitectura de Ficheros (Qu√© hace cada cosa)</h2>

        <div class="file-card">
            <h3>server_py/routers/ <span class="badge">Rutas de la API Base</span></h3>
            <p><strong>Prop√≥sito:</strong> Estos ficheros controlan c√≥mo el servidor web responde cuando el navegador (Frontend) le pide cosas. Separados para no mezclar l√≥gicas.</p>
            <ul>
                <li><strong><code>backups.py</code>:</strong> Controla el listado de Tareas de Backup en la UI. Permite iniciar, detener o leer el progreso de un backup en tiempo real.</li>
                <li><strong><code>storages.py</code>:</strong> Encargado de leer/escribir sobre el fichero <code>storages.json</code>. Valida que las credenciales de Amazon S3 / Wasabi sean correctas comprobando la conexi√≥n.</li>
                <li><strong><code>restore.py</code>:</strong> L√≥gica pesada que escanea en la nube qu√© carpetas y ordenadores hay guardados para poder pintar el √°rbol de directorios cuando le das a "Restaurar".</li>
                <li><strong><code>system.py</code>:</strong> Peque√±as rutas gen√©ricas, como el chequeo de "Salud" del servidor para mostrar el bot√≥n verde de "Servidor Activo" en la esquina.</li>
            </ul>
        </div>

        <div class="file-card">
            <h3>server_py/core/ <span class="badge">Orquestadores Centrales</span></h3>
            <p><strong>Prop√≥sito:</strong> Donde reside el coraz√≥n de la m√°quina. Estos ficheros operan de fondo independientemente de si hay un usuario conectado o no.</p>
            <ul>
                <li><strong><code>helpers.py</code>:</strong> Este fichero vigila el infinito (Cron Job). Est√° programado para despertar, leer a qu√© hora tocan los pr√≥ximos backups (seg√∫n <code>repos.json</code>) y arrancarlos sin que nadie tenga que darle a ning√∫n bot√≥n.</li>
                <li><strong><code>storage_helpers.py</code>:</strong> Herramientas auxiliares para traducir URLs gen√©ricas en rutas exactas que el CLI de Duplicacy entienda matem√°ticamente.</li>
                <li><strong><code>remote_cache.py</code>:</strong> Conecta ef√≠meramente con la nube para listar identificadores r√°pidos sin descargar megabytes de historial.</li>
            </ul>
        </div>

        <div class="file-card">
            <h3>web/js/modules/ <span class="badge">El Cerebro del Panel Web</span></h3>
            <p><strong>Prop√≥sito:</strong> La interfaz que ves al entrar al puerto <code>8500</code> est√° partida en "pedazos" visuales (JavaScript) para que navegue ultra r√°pido sin recargar la p√°gina web entera.</p>
            <ul>
                <li><strong><code>api.js</code>:</strong> Es el mensajero. Es el √∫nico fichero que sabe c√≥mo hacer peticiones HTTP (Fetch) hacia Python. Si hay un error de "Servidor no responde", salta aqu√≠.</li>
                <li><strong><code>views/</code> (Carpeta):</strong> Contiene ficheros como <code>dashboard.js</code> o <code>restore.js</code>. Si la pesta√±a "Dashboard" de la izquierda no carga, el problema est√° en ese √∫nico fichero. Cada uno pinta una secci√≥n de la aplicaci√≥n.</li>
                <li><strong><code>components/</code> (Carpeta):</strong> Contiene cosas "flotantes" en la pantalla, como los pop-ups (Modales) que oscurecen el fondo y te piden una contrase√±a o te dejan explorar tu disco duro visualmente.</li>
            </ul>
        </div>

        <h2 id="troubleshooting">üö® TroubleShooting: Soluci√≥n de Desastres Base</h2>

        <div class="file-card">
            <h3>Error: Nombre de Archivo muy largo (WinError 206) <span class="badge badge-warning">Limites SO</span></h3>
            <p>A veces al seleccionar 5,000 carpetas parciales para una restauraci√≥n selectiva cruzabas el infame l√≠mite de los 32.768 caracteres de argumento en el CMD de Windows, crasheando localmente el servicio de subida a la nube de Duplicacy.</p>
            <p><strong>Mitigaci√≥n en DupliManager:</strong> Ya est√° subsanado. El motor crear√° y escribir√° un `tempfile` f√≠sico con la flag `-ignore` que Duplicacy lee, por lo que es inmune asumiendo que el Disco Local primario no este 100% lleno. Solo revisa que tengas 1mb libre de espacio.</p>
        </div>

    </main>
</body>
</html>
